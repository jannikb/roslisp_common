(in-package :actionlib-test)

(define-test simple-csm-cancel-from-pending 
  (let ((scsm (make-instance 'actionlib-lisp::simple-comm-state-machine)))
    (actionlib-lisp::transition-to scsm :send-goal)
    (assert-equal :pending (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :pending)
    (assert-equal :pending (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :cancel-goal)
    (assert-equal :pending (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :preempting)
    (assert-equal :active (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :succeeded)
    (assert-equal :active (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :receive)
    (assert-equal :done (actionlib-lisp::comm-state scsm))))

(define-test simple-csm-cancel-from-active
  (let ((scsm (make-instance 'actionlib-lisp::simple-comm-state-machine)))
    (actionlib-lisp::transition-to scsm :send-goal)
    (assert-equal :pending (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :active)
    (assert-equal :active (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :cancel-goal)
    (assert-equal :active (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :recalling)
    (assert-equal :pending (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :recalled)
    (assert-equal :pending (actionlib-lisp::comm-state scsm))
    (actionlib-lisp::transition-to scsm :receive)
    (assert-equal :done (actionlib-lisp::comm-state scsm))))